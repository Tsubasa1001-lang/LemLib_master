# LemLib 數學計算與單位說明

> **專案名稱**: LemLib_1009  
> **版本**: 0.6.0  
> **目標平台**: VEX V5 機器人系統  
> **建立日期**: 2025年11月8日

---

## 1. 單位系統

LemLib 內建強型別單位，可直接進行運算與轉換。

### 1.1 長度 (Length)
```cpp
24_in; 30_cm; 1.5_m; 12_ft;
Length distance = 24_in;
Number inches = to_in(distance);
Number cm = to_cm(distance);
Number meters = to_m(distance);
```

### 1.2 角度 (Angle)
```cpp
90_deg; 90_cDeg; 1.57_rad; 1.57_stRad;
Angle angle = 90_cDeg;
Number degrees = to_cDeg(angle);
Number stdDeg = to_stDeg(angle);
Number radians = to_stRad(angle);
// 90_cDeg = 0.9 度
```

### 1.3 時間 (Time)
```cpp
Time duration = 1.5_sec;
Number seconds = to_sec(duration);
Number msec = to_msec(duration);
```

### 1.4 速度
```cpp
AngularVelocity w = 360_rpm;     // 角速度
LinearVelocity v = 12_inps;      // 線速度
```

### 1.5 溫度與電流
```cpp
Temperature temp = motors.getTemperature();
Number celsius = to_celsius(temp);

Current current = motors.getCurrent();
Number amps = to_amp(current);
```

---

## 2. 單位運算

### 2.1 基本運算
```cpp
Length total = 12_in + 6_in;
Length diff = 24_in - 6_in;
Length doubled = 12_in * 2;
Number ratio = 24_in / 12_in;
Length half = 24_in / 2;
```

### 2.2 比較與常用函數
```cpp
if (24_in > 12_in) { /* ... */ }

Length distance = abs(-12_in);
Length max_dist = max(12_in, 24_in);
Length clamped = clamp(15_in, 10_in, 20_in);
Number sign = sgn(-12_in);       // -1
```

---

## 3. 幾何型別

### 3.1 Pose (位置 + 姿態)
```cpp
units::Pose pose = {24_in, 12_in, 90_cDeg};
Length distance = pose.distanceTo({48_in, 24_in});
Angle angleToTarget = pose.angleTo({48_in, 24_in});
```

### 3.2 V2Position (2D 位置)
```cpp
units::V2Position pos = {24_in, 12_in};
units::V2Position polar = units::V2Position::fromPolar(90_cDeg, 12_in);
units::V2Position sum = pos + polar;
```

---

## 4. 數學工具函數

### 4.1 `angleError()`
```cpp
Angle angleError(Angle target, Angle position,
                std::optional<AngularDirection> direction = std::nullopt);
```
回傳從當前角度到目標角度的最短誤差，可選擇強制順/逆時針方向。

### 4.2 `slew()` - 斜率限制
```cpp
Number slew(Number target, Number current, Number maxChangeRate,
            Time deltaTime, SlewDirection restrictDirection = SlewDirection::ALL);
```
限制輸入變動的最大速率，常用於平滑加速。

### 4.3 `constrainPower()`
```cpp
Number constrainPower(Number power, Number max, Number min);
```
同時套用最小/最大絕對值，保持原符號，可避免輸出過小或過大。

### 4.4 `desaturate()`
```cpp
DriveOutputs desaturate(Number lateralOutput, Number angularOutput);
// 回傳 { left, right }，確保左右輪輸出皆在 ±1.0 內
```

### 4.5 `getSignedTangentArcCurvature()`
```cpp
Curvature getSignedTangentArcCurvature(units::Pose start, units::V2Position end);
```
計算從當前姿態到目標點的曲率，常見於路徑跟隨算法。

---

## 5. 快速轉換表

### 5.1 常用函數一覽
| 類型 | 轉換函數 | 範例 |
|------|----------|------|
| 長度 | `to_in()`, `to_cm()`, `to_m()` | `to_in(24_cm)` |
| 角度 | `to_cDeg()`, `to_stDeg()`, `to_stRad()` | `to_stDeg(90_cDeg)` |
| 溫度 | `to_celsius()`, `to_fahrenheit()` | `to_celsius(temp)` |
| 電流 | `to_amp()`, `to_mamp()` | `to_amp(current)` |

### 5.2 單位換算 (附錄 B)

| 長度 | 英寸 | 厘米 | 米 |
|------|------|------|-----|
| 1 英寸 | 1 | 2.54 | 0.0254 |
| 1 厘米 | 0.3937 | 1 | 0.01 |
| 1 米 | 39.37 | 100 | 1 |

| 角度 | 度 | 弧度 | 厘度 |
|------|-----|------|------|
| 1° | 1 | 0.01745 | 100 |
| 1 弧度 | 57.296 | 1 | 5729.6 |
| 1 厘度 | 0.01 | 0.0001745 | 1 |

---

需要進一步的上下文（如 PID 或運動控制）時，可回到 `docs/功能說明文檔.md` 查閱完整內容。
